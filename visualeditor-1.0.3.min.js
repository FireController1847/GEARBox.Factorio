/*! GEARBox.Factorio Visual Editor v1.0.3 | (c) 2025 FireController#1847 | Released under the GNU GPL v3.0 */
(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},s=[],l=0;l<e.length;l++){var a=e[l],c=o.base?a[0]+o.base:a[0],d=r[c]||0,u="".concat(c," ").concat(d);r[c]=d+1;var m=n(u),p={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==m)t[m].references++,t[m].updater(p);else{var f=i(p,o);o.byIndex=l,t.splice(l,0,{identifier:u,updater:f,references:1})}s.push(u)}return s}function i(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<r.length;s++){var l=n(r[s]);t[l].references--}for(var a=o(e,i),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=a}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,o,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var l=0;l<this.length;l++){var a=this[l][0];null!=a&&(s[a]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&s[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},358:(e,t,n)=>{n.d(t,{A:()=>l});var o=n(601),i=n.n(o),r=n(314),s=n.n(r)()(i());s.push([e.id,'*{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif}body{background-color:#000;display:flex;flex-direction:column;justify-content:center;align-items:center;position:absolute;top:0;left:0;bottom:0;right:0;overflow:hidden}ul{margin:0;padding:0;list-style:none}.box-style,.tm-tile,.te-sprite,.se-layer,.box-style-red{color:#fff;font-weight:bold;text-shadow:1px 2px rgba(0,0,0,.25);background-color:hsla(0,0%,100%,.55);border:1.25px solid hsla(0,0%,100%,.05);border-radius:8px;transition:background-color .125s,border .125s,box-shadow .125s;pointer-events:all}.box-style-red{background-color:rgba(255,0,0,.55);border:1.25px solid rgba(255,0,0,.05)}.box-hover-style:hover,.tm-tile:hover,.te-sprite:hover,.se-layer:hover,.box-hover-style-red:hover{background-color:hsla(0,0%,100%,.7);border:1.25px solid hsla(0,0%,100%,.3);box-shadow:0 0 8px rgba(0,0,0,.25);cursor:pointer}.box-hover-style-red:hover{background-color:rgba(255,0,0,.7)}.spacer{flex-grow:1}.hidden{display:none !important}#controls{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;position:absolute;top:0;left:0;padding:.5em;gap:.5em;z-index:2;pointer-events:none;user-select:none}#controls button{position:relative;width:100%;height:100%}#control-background{position:relative;height:5vh;width:3.5vw}#control-open-tile-manager{position:relative;height:5vh}#grid{display:grid;justify-content:center;align-items:center;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);transform-origin:center center;overflow:hidden;background-image:url("./resource/bg/background1.png");background-repeat:no-repeat;background-size:auto;background-position:0 0;z-index:1}#grid[data-background="1"]{background-position-x:-13px;background-image:url("./resource/bg/background2.png")}#grid[data-background="2"]{background-position:-32px;background-image:url("./resource/bg/background3.png")}.tile{width:var(--tile);height:var(--tile);position:relative;display:flex;justify-content:center;align-items:center;user-select:none}.tile::after{content:"";position:absolute;top:-6.5%;left:-6.5%;width:113%;height:113%;background-size:cover;background-repeat:no-repeat;opacity:0;z-index:2;pointer-events:none}.tile:hover::after{background-image:url("./resource/selection-box.png");opacity:1}.tile *{pointer-events:none}.tile-img-container *{user-select:none}.tile-img-container{position:absolute;display:flex;overflow:hidden}.tile-img-container img{position:absolute}#menus{display:flex;flex-direction:column;justify-content:center;align-items:center;position:absolute;top:0;left:0;bottom:0;right:0;z-index:3;pointer-events:none;user-select:none}.menu{display:flex;flex-direction:column;position:relative;height:80%;width:80%}.menu-title-bar{position:relative;display:flex;flex-direction:row;align-items:center;background-color:hsla(0,0%,100%,.26);padding:.2em 1em}.menu-title-bar .menu-title{position:relative;padding:0;margin:0}.menu-title-bar .menu-close{border-radius:200px;width:18px;height:18px;background-color:rgba(255,0,0,.65);border:2px solid rgba(0,0,0,.04)}.menu-title-bar .menu-close p{font-family:"Courier New",Courier,sans-serif;font-weight:normal;color:rgba(0,0,0,0);font-size:20px;text-shadow:none;transition:color .3s;margin-top:-7.5px;margin-left:-3px}.menu-title-bar .menu-close:hover p{color:rgba(0,0,0,.5)}.menu-content{flex-grow:1;padding:1em}.form-group,.form-group-small{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;flex-grow:1;padding:1em}.form-group-small{display:grid;grid-template-columns:repeat(2, 1fr);flex-wrap:wrap;gap:.75em 2em}.form-group-small label{margin:0;white-space:nowrap}.menu-bottom-bar{display:flex;flex-direction:row;align-items:center;justify-content:flex-end;background-color:hsla(0,0%,100%,.16);padding:.6em 1em;gap:.5em}#tile-editor-menu,#property-manager-menu,#sprite-editor-menu,#sprite-layer-editor-menu{width:50%}.tm-tile,.te-sprite,.se-layer{padding:.8em;margin-bottom:.2em}.tm-tile{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:.5em}.tm-tile label{margin:0}#sle-picture-preview-container{display:flex;justify-content:center;align-items:center;width:100%;height:64px;max-height:64px;margin:1em 0 0 0}#sle-picture-preview{width:auto;max-width:128px;height:auto;max-height:64px}#hotbar{display:flex;flex-direction:column;justify-content:flex-end;align-items:center;position:absolute;top:0;bottom:0;left:0;right:0;user-select:none;pointer-events:none;z-index:2}#hotbar-contents{display:flex;flex-direction:row;position:relative;margin-bottom:1em;gap:.2em}#hotbar-contents span,#hotbar-selector li{position:relative;display:block;width:64px;height:64px;background-color:rgba(0,0,0,.5);border:1px solid #000;pointer-events:all}#hotbar-contents span:hover,#hotbar-selector li:hover{border:1px solid hsla(0,0%,100%,.5);cursor:pointer}#hotbar-contents span.selected,#hotbar-selector li.selected{border-color:hsla(0,0%,100%,.85)}#hotbar-contents span small,#hotbar-selector li small{position:absolute;right:0;bottom:0;display:block;font-size:12px;color:hsla(0,0%,100%,.85);padding:.2em;padding-right:.6em}#hotbar-contents span img,#hotbar-selector li img{background-color:rgba(0,0,0,0);padding:.2em;width:100%;height:100%;object-fit:contain;border:none}#hotbar-contents span img[src=""]{display:none}#hotbar-selector{position:absolute;bottom:calc(1em + 64px + .2em);min-width:64px;height:64px;display:flex;flex-direction:row;margin-bottom:1em;gap:.2em;pointer-events:all}#hotbar-selector-list{display:flex;flex-direction:row;gap:.6em}#legend{position:absolute;top:0;right:0;font-size:.8em;color:hsla(0,0%,100%,.85);background-color:rgba(0,0,0,.25);border:1px solid rgba(0,0,0,.5);border-radius:18px;margin:.8em;padding:.6em;z-index:2}#legend ul{list-style:none;padding:0;margin:0}#legend ul li{border-bottom:1px solid rgba(0,0,0,.1);text-align:center}#legend ul li:last-child{border-bottom:none}#legend-close{position:absolute;top:0;right:0;background:none;border:none;color:hsla(0,0%,100%,.85);cursor:pointer;padding:.6em;z-index:2}#legend-close:hover{color:#fff}',""]);const l=s},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var o=n(72),i=n.n(o),r=n(825),s=n.n(r),l=n(659),a=n.n(l),c=n(56),d=n.n(c),u=n(540),m=n.n(u),p=n(113),f=n.n(p),h=n(358),g={};g.styleTagTransform=f(),g.setAttributes=d(),g.insert=a().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=m();i()(h.A,g);h.A&&h.A.locals&&h.A.locals;const y="tiles";function b(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=()=>t(o.result),o.onerror=n,o.readAsDataURL(e)})}let v=null,w=null;class x{grid;rows;cols;tileSizes=[16,32,48,64,80,96,112,128];zoomIndex;lastZoomAt=0;zoomDelay=240;isPointerDown=!1;pointerX=0;pointerY=0;pointerButton=null;hoveredTilesThisFrame=new Set;hoveredTilesDuringDrag=new Set;constructor(e,t,n,o=64){const i=document.getElementById(e);if(!(i instanceof HTMLDivElement))throw new Error(`Grid element with id "${e}" not found or not a div`);this.grid=i,this.rows=t,this.cols=n;const r=this.tileSizes.indexOf(o);this.zoomIndex=r>=0?r:3,this.createTiles(),this.applyZoom(!0),this.bindEvents()}get zoomScale(){return this.tileSizes[this.zoomIndex]/64}createTiles(){const e=document.createDocumentFragment();for(let t=0;t<this.rows;t++)for(let n=0;n<this.cols;n++){const o=document.createElement("div");o.className="tile",o.dataset.x=String(n),o.dataset.y=String(t),o.addEventListener("contextmenu",e=>e.preventDefault()),o.addEventListener("pointerenter",()=>{this.isPointerDown&&2===this.pointerButton&&(o.innerHTML="")}),e.appendChild(o)}this.grid.appendChild(e)}bindEvents(){this.grid.addEventListener("wheel",e=>{e.preventDefault();const t=performance.now();t-this.lastZoomAt<this.zoomDelay||(this.lastZoomAt=t,this.updateZoom(e.deltaY),this.applyZoom())},{passive:!1}),this.grid.addEventListener("pointerdown",e=>{this.isPointerDown=!0,this.pointerButton=e.button,this.pointerX=e.clientX,this.pointerY=e.clientY}),window.addEventListener("pointerup",()=>{this.isPointerDown=!1,this.pointerButton=null,this.hoveredTilesDuringDrag.clear()}),window.addEventListener("pointermove",e=>{this.pointerX=e.clientX,this.pointerY=e.clientY})}updateZoom(e){this.zoomIndex=e<0?Math.min(this.zoomIndex+1,this.tileSizes.length-1):Math.max(this.zoomIndex-1,0)}applyZoom(e=!1){const t=this.tileSizes[this.zoomIndex];this.grid.style.setProperty("--tile",`${t}px`),this.grid.dataset.zoom=String(this.zoomScale);for(const e in this.grid.children){const t=this.grid.children[e];if(t instanceof HTMLDivElement)for(const e of t.children)if(e instanceof HTMLDivElement&&e.classList.contains("tile-img-container")){const t=Number(e.dataset.shiftX||"0"),n=Number(e.dataset.shiftY||"0"),o=Number(e.dataset.scale||"1"),i=t*this.zoomScale*o,r=n*this.zoomScale*o;e.style.transform=`translate(${i}px, ${r}px) scale(${this.zoomScale*o})`}}e&&(this.grid.style.gridTemplateRows=`repeat(${this.rows}, var(--tile))`,this.grid.style.gridTemplateColumns=`repeat(${this.cols}, var(--tile))`);const n=t/128;this.grid.style.backgroundSize=`${3456*n}px ${2160*n}px`,this.hoveredTilesDuringDrag.clear()}updateMouseHover(){if(!this.isPointerDown||null==this.pointerButton)return;const e=document.elementFromPoint(this.pointerX,this.pointerY);if(e&&e.classList.contains("tile")){const t=e.getAttribute("data-x"),n=e.getAttribute("data-y");if(null==t||null==n)return;const o=Number(t),i=Number(n),r=`${o},${i}`;this.hoveredTilesThisFrame.has(r)||this.hoveredTilesDuringDrag.has(r)||(this.hoveredTilesThisFrame.add(r),this.hoveredTilesDuringDrag.add(r),this.onTileHoverWhileDown(o,i,e,this.pointerButton))}}placeTile(e,t,n,o){const i=this.getTileAt(e,t);if(i){i.innerHTML="",i.dataset.assignedTile=n.id,i.dataset.assignedSprite=o.id;for(const e of o.layers){if(null==e.fileData)continue;const t=document.createElement("div");t.classList.add("tile-img-container"),t.style.width=String(e.width)+"px",t.style.height=String(e.height)+"px";const n=document.createElement("img");if(n.src=e.fileData,!e.drawAsShadow&&e.variants>1){const t=Math.floor(Math.random()*(e.variants-1-0+1)+0);n.style.left="-"+String(t*e.width)+"px"}t.dataset.shiftX=String(2*e.shiftX),t.dataset.shiftY=String(2*e.shiftY),t.dataset.scale=String(e.scale);let o=2*e.shiftX*this.zoomScale*e.scale,r=2*e.shiftY*this.zoomScale*e.scale;t.style.transform=`translate(${o}px, ${r}px) scale(${this.zoomScale*e.scale})`,t.appendChild(n),e.drawAsShadow?i.prepend(t):i.appendChild(t)}}}onTileHoverWhileDown(e,t,n,o){if(0===o){if(!v||!w)return;this.placeTile(e,t,v,w)}else 2===o&&(n.innerHTML="",n.dataset.assignedTile="",n.dataset.assignedSprite="")}getTileAt(e,t){return this.grid.querySelector(`.tile[data-x="${e}"][data-y="${t}"]`)}convertPointerPosToTileCoords(){const e=this.getPointerPosition();if(null==e)return null;const t=this.grid.getBoundingClientRect(),n=e.x-t.left,o=e.y-t.top,i=this.tileSizes[this.zoomIndex],r=Math.floor(n/i),s=Math.floor(o/i);return r<0||s<0||r>=this.cols||s>=this.rows?null:{x:r,y:s}}getPointerPosition(){return null!=this.pointerX&&null!=this.pointerY?{x:this.pointerX,y:this.pointerY}:null}resetFrameHistory(){this.hoveredTilesThisFrame.clear()}}function S(e){if(e<1||e>10)return;const t=document.getElementById(`slot-${e}`);if(null!=t){for(let e=1;e<=10;e++){const t=document.getElementById(`slot-${e}`);t&&t.classList.remove("selected")}t.classList.add("selected");const e=document.getElementById("hotbar-selector"),n=document.getElementById("hotbar-selector-list");if(null!=e&&null!=n){const e=T.find(e=>e.id===t.dataset.tileId);null!=e&&(v=e,w=e.sprites.length>0?e.sprites[0]:null),function(e){const t=document.getElementById("hotbar-selector"),n=document.getElementById("hotbar-selector-list");if(null!=t&&null!=n&&null!=e){n.innerHTML="";const o=T.find(t=>t.id===e);if(o){t.classList.remove("hidden");for(const e of o.sprites){const t=document.createElement("li");t.dataset.tileId=o.id,t.dataset.spriteId=e.id,e.id===w?.id&&t.classList.add("selected"),t.onclick=function(){v=o,w=e;for(const e of n.children)e.classList.remove("selected");t.classList.add("selected")};const i=document.createElement("small");i.innerText=e.property||"(no property)",t.appendChild(i);const r=document.createElement("img");for(const t of e.layers)null==t.fileData||t.drawAsShadow||(r.src=t.fileData);if(""==r.src)for(const t of e.layers)null!=t.fileData&&(r.src=t.fileData);t.appendChild(r),n.appendChild(t)}}else v=null,w=null,t.classList.add("hidden")}}(t.dataset.tileId)}}}function E(e){const t=document.createElement("label");t.innerText="Slot: ";const n=function(e){const t=document.createElement("input");t.type="number",t.min="0",t.max="10";const n=document.getElementsByClassName("slot");let o=!1;for(let i=0;i<n.length;i++)n[i].dataset.tileId===e.id&&(t.value=String(i+1),o=!0);o||(t.value="0");let i=Number(t.value);return t.onchange=function(){const n=Number(t.value),o=n>i?1:n<i?-1:0;i=n;const r=document.getElementById(`slot-${n}`);if(null!=r){if(""!=r.dataset.tileId)return t.value=String(1===o?n+1:n-1),void(i=Number(t.value));for(let t=1;t<=10;t++){const n=document.getElementById(`slot-${t}`);if(n&&n.dataset.tileId===e.id){n.dataset.tileId="";for(const e of n.children)e instanceof HTMLImageElement&&(e.src="")}}for(const t of r.children)if(t instanceof HTMLImageElement)for(const n of e.sprites)for(const e of n.layers)e.fileData&&!e.drawAsShadow&&(t.src=e.fileData);r.dataset.tileId=e.id,N()}else if(0==n){const t=document.getElementsByClassName("slot");for(const n of t){const t=n;if(t.dataset.tileId===e.id){t.dataset.tileId="";for(const e of t.children)e instanceof HTMLImageElement&&(e.src="");N()}}}(n<0||n>10)&&(t.value="0")},t.onclick=function(e){e.stopPropagation()},t}(e),o=document.createElement("div");o.classList.add("spacer");const i=document.createElement("div");return i.innerText=e.name,i.classList.add("tm-tile"),i.onclick=function(){D=e,C("tile-editor-menu")},i.appendChild(o),i.appendChild(t),i.appendChild(n),i}function k(e){const t=document.createElement("div");return t.innerText=e.property||"(no property)",t.classList.add("te-sprite"),t.onclick=function(){L=e,C("sprite-editor-menu")},t}function I(e){const t=document.createElement("div");return t.innerText=e.fileName?e.fileName:"(no file)",t.classList.add("se-layer"),t.onclick=function(){B=e,C("sprite-layer-editor-menu")},t}const T=function(){const e=localStorage.getItem(y);if(!e)return[];try{const t=JSON.parse(e);return t.forEach(e=>{if(null!=e.assignedSlot){const t=document.getElementById(`slot-${e.assignedSlot}`);if(t){for(const n of t.children)if(n instanceof HTMLImageElement)for(const t of e.sprites)for(const e of t.layers)e.fileData&&!e.drawAsShadow&&(n.src=e.fileData);t.dataset.tileId=e.id}}}),t}catch(e){return[]}}();window.tiles=T;let D=null,L=null,B=null,A=null;function N(){const e=document.getElementById("hotbar-contents");if(e){const t=e.querySelector("span.selected");t&&S(Number(t.id.replace("slot-","")))}!async function(e){const t=[],n={};document.querySelectorAll(".slot").forEach(e=>{if(e.dataset.tileId){const t=e.dataset.tileId,o=Number(e.id.replace("slot-",""));n[t]=o}});for(const o of e){const e=[];for(const t of o.sprites){const n=[];for(const e of t.layers){let t=e.fileData,o=e.fileName;e.file instanceof File&&(t=await b(e.file),o=e.file.name),n.push({...e,fileName:o,fileData:t})}e.push({...t,layers:n})}t.push({...o,sprites:e,assignedSlot:n[o.id]??null})}localStorage.setItem(y,JSON.stringify(t))}(T)}function C(e){A&&z(A,!0),A=e;const t=document.getElementById(e);if(t){if("tile-manager-menu"==e){const e=document.getElementById("tm-tile-list");if(e){e.innerHTML="";for(const t of T){const n=E(t);e.appendChild(n)}}}else if("tile-editor-menu"==e){const e=document.getElementById("te-tile-name");e&&D&&(e.value=D.name);const t=document.getElementById("te-tile-list");if(t&&D){t.innerHTML="";for(const e of D.sprites){const n=k(e);t.appendChild(n)}}}else if("sprite-editor-menu"==e){const e=document.getElementById("se-property");e&&L&&(e.value=L.property);const t=document.getElementById("se-sprite-layers");if(t&&L){t.innerHTML="";for(const e of L.layers){const n=I(e);t.appendChild(n)}}}else if("sprite-layer-editor-menu"==e){const e=document.getElementById("sle-picture-upload");e&&(e.value="");const t=document.getElementById("sle-picture-preview");t&&(B&&null!=B.fileData?t.src=B.fileData:t.src="");const n=document.getElementById("sle-width");n&&B&&(n.value=B.width.toString());const o=document.getElementById("sle-height");o&&B&&(o.value=B.height.toString());const i=document.getElementById("sle-variants");i&&B&&(i.value=B.variants.toString());const r=document.getElementById("sle-offset-x");r&&B&&(r.value=B.shiftX.toString());const s=document.getElementById("sle-offset-y");s&&B&&(s.value=B.shiftY.toString());const l=document.getElementById("sle-scale");l&&B&&(null==B.scale&&(B.scale=1),l.value=B.scale.toString());const a=document.getElementById("sle-draw-as-shadow");a&&B&&(a.checked=B.drawAsShadow)}t.classList.remove("hidden")}}function z(e,t){const n=document.getElementById(e);n&&n.classList.add("hidden"),t||(D=null,L=null,B=null),A=null}window.openMenu=C,window.closeMenu=z,window.getTileAtCursor=function(e){if(null==e.getPointerPosition())return null;const t=e.convertPointerPosToTileCoords();if(null==t)return null;const n=e.getTileAt(t.x,t.y);if(null==n)return null;const o=n.dataset.assignedTile;if(null==o||""===o)return null;const i=T.find(e=>e.id===o);if(null==i)return null;const r=n.dataset.assignedSprite;if(null==r||""===r)return null;const s=i.sprites.find(e=>e.id===r);return null==s?null:{tile:i,sprite:s}},document.addEventListener("DOMContentLoaded",()=>{const e=new x("grid",16,24,64);window.grid=e;const t=document.getElementById("grid");let n=0,o=0;const i=new Set,r=document.getElementsByClassName("slot");for(let e=0;e<r.length;e++){r[e].onclick=()=>{S(e+1)}}if(document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("keydown",t=>{const n=t.key.toLowerCase();if("escape"==n&&(A&&(z(A,!1),A=null),t.preventDefault()),null==A)if(["w","a","s","d"].includes(n))i.add(n),t.preventDefault();else if(["1","2","3","4","5","6","7","8","9","0"].includes(n)){let e=Number(n);if(t.metaKey||t.ctrlKey){const n=document.getElementById("hotbar-selector-list");if(n&&n.children.length>0&&n.children.length>=e){n.children[e-1].click()}t.preventDefault()}else 0==e&&(e=10),isNaN(e)||S(e)}else if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(null==e.getPointerPosition())return null;const n=e.convertPointerPosToTileCoords();if(null==n)return null;const{tile:o,sprite:i}=window.getTileAtCursor(e)??{};if(!o||!i)return;if(t.shiftKey){for(const e of i.layers)if(!e.drawAsShadow)switch(t.key){case"ArrowLeft":e.shiftX-=1;break;case"ArrowRight":e.shiftX+=1;break;case"ArrowUp":e.shiftY-=1;break;case"ArrowDown":e.shiftY+=1}o.sprites=o.sprites.map(e=>e.id===i.id?i:e),e.placeTile(n.x,n.y,o,i),N(),t.preventDefault()}else if(t.metaKey||t.ctrlKey){for(const e of i.layers)if(e.drawAsShadow)switch(t.key){case"ArrowLeft":e.shiftX-=1;break;case"ArrowRight":e.shiftX+=1;break;case"ArrowUp":e.shiftY-=1;break;case"ArrowDown":e.shiftY+=1}o.sprites=o.sprites.map(e=>e.id===i.id?i:e),e.placeTile(n.x,n.y,o,i),N(),t.preventDefault()}}else if(["+","=","-","_"].includes(t.key)||"="===t.key&&t.shiftKey){if(null==e.getPointerPosition())return null;const n=e.convertPointerPosToTileCoords();if(null==n)return null;const{tile:o,sprite:i}=window.getTileAtCursor(e)??{};if(!o||!i)return;if(t.shiftKey){for(const e of i.layers)if(!e.drawAsShadow)switch(t.key){case"=":case"+":e.scale+=.1;break;case"_":case"-":e.scale-=.1}o.sprites=o.sprites.map(e=>e.id===i.id?i:e),e.placeTile(n.x,n.y,o,i),N(),t.preventDefault()}else if(t.metaKey||t.ctrlKey){for(const e of i.layers)if(e.drawAsShadow)switch(t.key){case"=":case"+":e.scale+=.1;break;case"_":case"-":e.scale-=.1}o.sprites=o.sprites.map(e=>e.id===i.id?i:e),e.placeTile(n.x,n.y,o,i),N(),t.preventDefault()}t.preventDefault()}else if("l"===t.key){const e=document.getElementById("legend");e&&(e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden"))}}),document.addEventListener("keyup",e=>{if(null!=A)return;const t=e.key.toLowerCase();["w","a","s","d"].includes(t)&&(i.delete(t),e.preventDefault())}),window.addEventListener("blur",()=>i.clear()),document.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&i.clear()}),function(){document.querySelectorAll(".menu-close").forEach(e=>{e.onclick=function(){const t=e.closest(".menu");t&&z(t.id,!1)}});const e=document.querySelector("#control-open-tile-manager > button");e&&(e.onclick=function(){C("tile-manager-menu")});const t=document.querySelector("#tm-create-tile-control > button");t&&(t.onclick=function(){D={id:crypto.randomUUID(),name:"New Tile",sprites:[]},C("tile-editor-menu")});const n=document.querySelector("#te-delete-tile-control > button");n&&(n.onclick=function(){if(D){const e=T.findIndex(e=>null!=D&&e.id===D.id);-1!==e&&T.splice(e,1)}N(),C("tile-manager-menu")});const o=document.querySelector("#te-discard-changes-control > button");o&&(o.onclick=function(){D=null,C("tile-manager-menu")});const i=document.querySelector("#te-save-changes-control > button");i&&(i.onclick=function(){if(D){const e=document.getElementById("te-tile-name");e&&(D.name=e.value);let t=!1;for(let e=0;e<T.length;e++)if(T[e].id===D.id){T[e]=D,t=!0;break}t||T.push(D),v=D,w=D.sprites.length>0?D.sprites[0]:null}N(),C("tile-manager-menu")});const r=document.querySelector("#te-add-sprite-control > button");r&&(r.onclick=function(){i?.click(),L={id:crypto.randomUUID(),property:"",layers:[]},C("sprite-editor-menu")});const s=document.querySelector("#se-delete-sprite-control > button");s&&(s.onclick=function(){if(L&&D){const e=D.sprites.indexOf(L);-1!==e&&D.sprites.splice(e,1)}N(),C("tile-editor-menu")});const l=document.querySelector("#se-discard-changes-control > button");l&&(l.onclick=function(){L=null,C("tile-editor-menu")});const a=document.querySelector("#se-save-changes-control > button");a&&(a.onclick=function(){if(L&&D){const e=document.getElementById("se-property");e&&(L.property=e.value),document.getElementById("se-layer-list")&&(L.layers=[]);let t=!1;for(let e=0;e<D.sprites.length;e++)if(D.sprites[e].id===L.id){D.sprites[e]=L,t=!0;break}t||D.sprites.push(L)}N(),C("tile-editor-menu")});const c=document.querySelector("#se-add-sprite-layer-control > button");c&&(c.onclick=function(){a?.click(),B={id:crypto.randomUUID(),fileName:null,fileData:null,width:0,height:0,variants:1,shiftX:0,shiftY:0,scale:1,drawAsShadow:!1},C("sprite-layer-editor-menu")});const d=document.querySelector("#sle-picture-upload");d&&(d.onchange=function(){const e=d.files?.[0];if(e){const t=new FileReader;t.onload=function(e){const t=document.getElementById("sle-picture-preview");t&&(t.src=e.target?.result,t.style.display="block")},t.readAsDataURL(e)}});const u=document.querySelector("#sle-delete-sprite-layer-control > button");u&&(u.onclick=function(){if(B&&L&&D){const e=L.layers.indexOf(B);-1!==e&&L.layers.splice(e,1)}N(),C("sprite-editor-menu")});const m=document.querySelector("#sle-discard-changes-control > button");m&&(m.onclick=function(){B=null,C("sprite-editor-menu")});const p=document.querySelector("#sle-save-changes-control > button");p&&(p.onclick=function(){if(B&&L&&D){const e=document.getElementById("sle-picture-upload"),t=document.getElementById("sle-width"),n=document.getElementById("sle-height"),o=document.getElementById("sle-variants"),i=document.getElementById("sle-offset-x"),r=document.getElementById("sle-offset-y"),s=document.getElementById("sle-scale"),l=document.getElementById("sle-draw-as-shadow");if(e&&null!=e.files&&e.files.length>0&&e&&e.files&&e.files.length>0){const t=e.files[0];B.fileName=t.name;const n=new FileReader;n.onload=()=>{null!=B&&(B.fileData=n.result)},n.readAsDataURL(t)}t&&(B.width=Number(t.value)),n&&(B.height=Number(n.value)),o&&(B.variants=Number(o.value)),i&&(B.shiftX=Number(i.value)),r&&(B.shiftY=Number(r.value)),s&&(B.scale=Number(s.value)),l&&(B.drawAsShadow=l.checked);let a=!1;for(const e of L.layers)if(e.id===B.id){a=!0;break}a||L.layers.push(B),N(),C("sprite-editor-menu")}});const f=document.querySelector("#control-background > button");f&&(f.onclick=function(){const e=document.getElementById("grid");if(!e)return;const t=Number(e.dataset.background);e.dataset.background=isNaN(t)?"1":String((t+1)%3),f.innerText=String(Number(e.dataset.background)+1)});const h=document.querySelector("#legend-close");h&&(h.onclick=function(){const e=document.getElementById("legend");e&&e.classList.add("hidden")})}(),S(1),"2"===localStorage.getItem("legendShown")){const e=document.getElementById("legend");e&&e.classList.add("hidden")}else"1"===localStorage.getItem("legendShown")?localStorage.setItem("legendShown","2"):localStorage.setItem("legendShown","1");const s=()=>{null!=A||(i.has("w")&&(o+=6),i.has("s")&&(o-=6),i.has("a")&&(n+=6),i.has("d")&&(n-=6),t.style.transform=`translate3d(calc(-50% + ${n}px), calc(-50% + ${o}px), 0)`,e.updateMouseHover(),e.resetFrameHistory()),requestAnimationFrame(s)};requestAnimationFrame(s)})})();